## Demo #1

В целом тут показано, как я решаю задачу в обычном для меня флоу.

## Use Case UC-001: Создание бронирования охотничьего тура ##

### Описание ###
Позволяет пользователю создать новое бронирование охотничьего тура с выбранным гидом на конкретную дату.

### Основной поток ###

Запрос на создание: Пользователь отправляет POST запрос на /api/bookings с данными бронирования

Валидация данных: Система проверяет корректность всех обязательных полей

Проверка гида: Система убеждается, что выбранный гид существует и активен

Проверка доступности: Система проверяет, что у гида нет других бронирований на указанную дату

Проверка участников: Система проверяет, что количество участников не превышает лимит в 10 человек

Создание бронирования: Система создает запись бронирования в базе данных

Успешный ответ: Система возвращает айди созданного бронирования и кидает событие

### Альтернативные потоки ###
A1: Гид не найден
Условие: Указанный guide_id не существует в системе

Действие: Возврат ошибки валидации

HTTP статус: 400 Bad Request

A2: Гид недоступен на дату
Условие: У выбранного гида уже есть бронирование на указанную дату

Действие: Возврат ошибки валидации

HTTP статус: 422 Unprocessable Entity

A3: Превышено количество участников
Условие: Количество участников превышает максимальный лимит (10 человек)

Действие: Возврат ошибки валидации

HTTP статус: 422 Unprocessable Entity

A4: Гид неактивен
Условие: Выбранный гид помечен как неактивный (is_active = false)

Действие: Возврат ошибки валидации

HTTP статус: 422 Unprocessable Entity

## Запрос ##
curl -L 'http://localhost:8001/api/bookings' \
-d '{
"tour_name": "Elk Hunting Tour",
"hunter_name": "John Doe",
"guide_id": 2,
"date": "2024-12-25",
"participants_count": 4
}'


## Docker ##
В целом я поднимал это для локального использования. Не особо долго над этим думая. 
Не подойдет для, например, gitlab ci. Но что нужно сделать: проверить все порты сервисов nginx и mysql.
Mysql выбран случайно. Просто под рукой что-то оказалось. Может, позже на что-то более адекватное перейду
Ну, и нет всяких очередей, редисов и тому подобного.

## Как запустить ##
- git clone
- docker compose -f .\docker\docker-compose.yml -p demo-1 up -d
- после того, как контейнеры стартовали, нужно зайти в контейнер  app: docker exec -it demo_1_app /bin/bash
- в контейнере выполнить composer update, например
- в контейнере выполнить php artisan php artisan key:generate
- в контейнере выполнить php artisan migrate
- в контейнере выполнить php artisan db:seed


## Заметки ##
- Кстати, айди бы переделать не как автоинкрементарные, а как guid
- Удалил интерфейсы для репозиториев. Они в этом решении лишние. И смысда не несут. Вот если бы, например, были разные окружения и для каждого из них была своя бд, тогда да
- Это просто для примера все.

## Интеграция с Core ##
В целом это решение не DDD.
В рамках laravel делать UoW как-то такое себе.
Поэтому буду считать, что Core - это то, что есть в app.
На данный момент - это небольшая (и не особо продуманная) обработка эксепшенов.
Я не знаю, что в данном проекте уже есть в Core. Поэтому что там использовать можно - не знаю. Может, какие-то вспомогательные либы или хэлперы. Но тогда их можно вынести в фасады или типа того. Вынести их в отдельные репозитории, например, хэлперы для работы с датами, строками. И подключать через composer
Могу предположить, что могут быть модели в Core. Но я сделал модели в каждом модуле. То есть связанность модулей происходит на уровне данных, а не моделей. Например, в Guides модель Guide доступна для инсерта. В HuntingBooking - нет.
Добавил события. Хэндлеры их слушателей просто пишут в лог. Но так-то надо организовать отправку имейлов. Но это демо.
Например, когда заявка на тур создана, то Менеджеру должно улетать сообщение. В целом в разные каналы можно сделать, но. 
Менеджера назвал админом. Не знаю какие у вас есть роли. Ну и канал рассылки - имейл. Если нужно другие каналы, то это уже в других листенерах делать.

Например, в BookingCore есть решение для каких-то дефолтных параметров. Данные находятся в таблице system_params.
Например, в условиях есть критерий проверки на максимальное кол-во участников. Это значение равно 10. Можно, конечно, в каких-то инамах указывать.
Можно и в таблице. Что позволяет редактировать в админке какой-нибудь, нпример, в orchid.
